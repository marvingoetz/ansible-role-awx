---
- name: install git
  package:
    name: "{{ item }}"
    state: present
  loop:
    - git
    - python-setuptools
    - python3-setuptools
    - python3-wheel
    - python3-pip


- name: check out master branch
  git:
    repo: 'https://github.com/ansible/awx'
    dest: /srv/awx
    version: devel

- name: Upgrade pip to the last version
  pip:
    name: pip
    virtualenv: /srv/awx/virtualenv
    virtualenv_command: /usr/bin/python3 -m venv

- name: Install python modules
  pip:
    name: "{{ item }}"
    virtualenv: /srv/awx/virtualenv
    virtualenv_command: /usr/bin/python3 -m venv
  loop:
    - docker
    - docker-compose
    - ansible==2.7.10
- name: Run installer
  command: "/srv/awx/virtualenv/bin/ansible-playbook -i inventory install.yml"
  args:
    chdir: /srv/awx/installer
